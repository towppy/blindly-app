# PeakPlay – E-Commerce App (Full Project Setup Guide)

> **For group members:** This README covers everything you need to get both the backend and frontend running from scratch on your own machine. Read it fully before starting.

---

## Table of Contents

1. [Project Overview](#project-overview)
2. [Tech Stack](#tech-stack)
3. [Repository Structure](#repository-structure)
4. [Files to EXCLUDE from Git](#files-to-exclude-from-git)
5. [Prerequisites – Install These First](#prerequisites--install-these-first)
6. [External Services You Need to Set Up](#external-services-you-need-to-set-up)
   - [MongoDB Atlas](#1-mongodb-atlas)
   - [Firebase Project + FCM](#2-firebase-project--fcm)
7. [Backend Setup](#backend-setup)
8. [Frontend Setup](#frontend-setup)
9. [Running the App](#running-the-app)
10. [Push Notifications Setup](#push-notifications-setup)
11. [Further Development Notes](#further-development-notes)

---

## Project Overview

A full-stack mobile e-commerce application built with:
- **Backend**: Node.js + Express.js REST API, MongoDB (Atlas), Firebase Admin SDK for push notifications
- **Frontend**: React Native (Expo), Expo Go compatible, OpenStreetMap for address maps, Firebase FCM for push notifications

---

## Tech Stack

| Layer | Technology |
|---|---|
| Frontend | React Native, Expo SDK 54, Redux |
| Navigation | React Navigation (Drawer, Stack, Tabs) |
| Backend | Node.js, Express.js |
| Database | MongoDB Atlas (cloud hosted) |
| Auth | JWT (JSON Web Tokens) |
| Push Notifications | Firebase Cloud Messaging (FCM) + Expo Push API |
| Maps | OpenStreetMap via Leaflet (WebView, no API key needed) |
| Image Upload | Multer (local `uploads/` folder on backend) |

---

## Repository Structure

```
repo-root/
├── backend/          ← Express.js API server
│   ├── config/       ← DB connection, app config
│   ├── middleware/   ← Auth middleware (JWT)
│   ├── models/       ← Mongoose schemas (User, Product, Order, Category)
│   ├── routes/       ← API route handlers
│   ├── services/     ← Firebase/push notification logic
│   ├── uploads/      ← Product images (auto-created, NOT in git)
│   ├── .env          ← Your secret keys (NOT in git)
│   ├── .env.example  ← Template showing required keys
│   ├── package.json
│   └── server.js     ← Entry point
│
├── frontend-expo/    ← React Native Expo app
│   ├── assets/
│   │   └── common/
│   │       └── baseurl.js   ← SET YOUR BACKEND IP HERE
│   ├── Context/      ← Auth context (JWT, login state)
│   ├── Navigators/   ← App navigation structure
│   ├── Redux/        ← Cart state management
│   ├── Screens/      ← All app screens
│   ├── Shared/       ← Reusable components (Input, Header, etc.)
│   ├── app.json      ← Expo config (package name, Firebase, etc.)
│   ├── google-services.json  ← Firebase Android config (NOT in git)
│   └── package.json
│
└── README.md         ← This file
```

---

## Files to EXCLUDE from Git

**Never commit these.** Add a `.gitignore` at both the repo root and inside each folder.

### Files that contain secrets / are machine-specific:

| File | Why exclude |
|---|---|
| `backend/.env` | Contains your MongoDB password, JWT secret, etc. |
| `backend/*firebase-adminsdk*.json` | Firebase service account — has private keys |
| `backend/uploads/` | Product images uploaded at runtime, not source code |
| `backend/node_modules/` | Auto-generated by `npm install` |
| `frontend-expo/google-services.json` | Firebase Android config with your project credentials |
| `frontend-expo/node_modules/` | Auto-generated by `npm install` |
| `frontend-expo/.expo/` | Local Expo cache/state, machine-specific |
| `frontend-expo/package-lock.json` | Optional: include if you want exact version pinning |

### Recommended `.gitignore` for repo root:

```gitignore
# Backend
backend/node_modules/
backend/.env
backend/uploads/
backend/*firebase-adminsdk*.json
backend/firebase-service-account*.json
backend/npm-debug.log*

# Frontend
frontend-expo/node_modules/
frontend-expo/.expo/
frontend-expo/google-services.json
frontend-expo/npm-debug.log*
```

---

## Prerequisites – Install These First

Before doing anything, make sure you have these installed on your machine:

1. **Node.js v18 or higher**
   - Download: https://nodejs.org
   - Verify: `node --version` (should show v18+)

2. **npm** (comes with Node.js)
   - Verify: `npm --version`

3. **Expo CLI** (optional but helpful)
   - Install globally: `npm install -g expo-cli`

4. **Expo Go app on your phone**
   - Android: Search "Expo Go" on the Play Store
   - iOS: Search "Expo Go" on the App Store
   - Your phone and laptop **must be on the same WiFi network**

5. **Git**
   - Download: https://git-scm.com

---

## External Services You Need to Set Up

> These are things outside the code. You cannot run the app without them.

### 1. MongoDB Atlas

MongoDB Atlas is the cloud database where all app data (users, products, orders) is stored.

**Steps:**
1. Go to https://www.mongodb.com/atlas and create a free account.
2. Create a new **free cluster** (M0 Sandbox is free).
3. Under **Database Access**: create a new database user with a username and password. Save these — you'll need them.
4. Under **Network Access**: click **"Add IP Address"** → **"Allow Access from Anywhere"** (`0.0.0.0/0`) for development. (Restrict this in production.)
5. Go to **Clusters** → **Connect** → **Connect your application** → copy the connection string. It looks like:
   ```
   mongodb+srv://USERNAME:PASSWORD@cluster0.xxxxx.mongodb.net/?retryWrites=true&w=majority
   ```
   Replace `USERNAME` and `PASSWORD` with what you created in step 3.
6. Paste this string as `CONNECTION_STRING` in your `backend/.env` file (see [Backend Setup](#backend-setup) below).

---

### 2. Firebase Project + FCM

Firebase is used for **push notifications** (order updates, stock alerts). This is optional for basic app usage — the app will run without it, but push notifications won't work.

**Steps:**

#### A. Create a Firebase Project
1. Go to https://console.firebase.google.com and sign in with a Google account.
2. Click **"Add project"**, give it a name (e.g. `my-ecommerce-app`), and follow the wizard.
3. Disable Google Analytics if you don't need it.

#### B. Register an Android App
1. Inside your Firebase project, click the **Android icon** (add app).
2. Set the **Android package name** exactly as it is in `frontend-expo/app.json`:
   ```
   com.peakplay.itcp239
   ```
   > If you change this, update `app.json` too.
3. Click **"Register App"**.
4. Download the `google-services.json` file that Firebase gives you.
5. Place this file inside `frontend-expo/google-services.json` (replace the existing one).
6. Click through the remaining steps in the wizard (no extra SDK setup needed for Expo).

#### C. Enable Cloud Messaging (FCM)
1. In the Firebase console, go to **Project Settings** (gear icon, top left).
2. Click the **"Cloud Messaging"** tab.
3. Make sure **Firebase Cloud Messaging API (V1)** is **Enabled**. (Legacy API is deprecated.)

#### D. Download the Firebase Admin SDK Service Account (for backend)
1. In **Project Settings** → **Service Accounts** tab.
2. Click **"Generate new private key"** → **"Generate Key"**.
3. A `.json` file will download. **This is your Firebase Admin SDK service account key.**
4. Rename it to something simple like `firebase-service-account.json`.
5. Place it inside the `backend/` folder.
6. In your `backend/.env`, set:
   ```
   FCM_SERVICE_ACCOUNT_PATH=firebase-service-account.json
   ```
   > **NEVER commit this file to git.** It contains private keys that give full Firebase access.

---

## Backend Setup

After setting up MongoDB Atlas and Firebase (above):

### 1. Navigate to the backend folder
```bash
cd backend
```

### 2. Install dependencies
```bash
npm install
```

### 3. Create your `.env` file
Copy the example file:
```bash
cp .env.example .env
```
Then open `.env` and fill in all values:

```dotenv
NODE_ENV=development
PORT=4000
API_PREFIX=/api/v1

# MongoDB Atlas — paste your full connection string here
CONNECTION_STRING=mongodb+srv://YOUR_USERNAME:YOUR_PASSWORD@cluster0.xxxxx.mongodb.net/?retryWrites=true&w=majority
DB_NAME=ITCP_database

# JWT — set this to any long random string (keep it secret)
JWT_SECRET=some-very-long-random-string-you-make-up

JWT_EXPIRES_IN=7d
CORS_ORIGIN=*
UPLOAD_DIR=uploads
MAX_FILE_SIZE_MB=5

# Firebase — the service account .json file you downloaded from Firebase Console
# Place the file inside the backend folder and set the filename here
FCM_SERVICE_ACCOUNT_PATH=firebase-service-account.json
```

**Key explanations:**

| Key | What it is | Where to get it |
|---|---|---|
| `CONNECTION_STRING` | MongoDB Atlas URI | Atlas → Connect → your app |
| `DB_NAME` | Database name inside Atlas | Your choice, default is `ITCP_database` |
| `JWT_SECRET` | Secret for signing login tokens | Make up any long random string |
| `FCM_SERVICE_ACCOUNT_PATH` | Filename of Firebase service account JSON | Download from Firebase Console → Service Accounts |

### 4. Start the backend
```bash
npm start
```
You should see:
```
[db] MongoDB connected
[server] Listening on port 4000
[server] Health check: http://localhost:4000/api/v1/health
```

Open `http://localhost:4000/api/v1/health` in a browser — it should return `{ ok: true }`.

---

## Frontend Setup

### 1. Navigate to the frontend folder
```bash
cd frontend-expo
```

### 2. Install dependencies
```bash
npm install
```
> You may see deprecation warnings and vulnerability notices — these are from Expo's own dependencies. Run `npm run audit:fix` (NOT `npm audit fix --force`) to apply safe fixes. Some warnings will remain — that is normal and acceptable.

### 3. Place your `google-services.json`
- Get the file from Firebase Console (see [Firebase Setup](#b-register-an-android-app) above).
- Place it at: `frontend-expo/google-services.json`
- This file is required for push notifications to work on Android.

### 4. Set the backend IP address
- Find your laptop's local IP address:
  - **Windows:** Open Command Prompt → run `ipconfig` → look for **IPv4 Address** under your WiFi adapter (e.g. `192.168.1.105`)
  - **Mac/Linux:** Run `ifconfig` or check WiFi settings
- Open `frontend-expo/assets/common/baseurl.js`
- Change `BACKEND_HOST` to your laptop's IP:
  ```js
  const BACKEND_HOST = 'http://192.168.1.105:4000';
  ```
  > Your phone and laptop must be on the **same WiFi network**. This IP will change if you switch networks.

---

## Running the App

### Start the backend first
```bash
cd backend
npm start
```
Keep this terminal running.

### Start the frontend in a second terminal
```bash
cd frontend-expo
npx expo start --go -c
```
- The `-c` flag clears the cache on start (avoids stale bundle issues).
- Open **Expo Go** on your phone and scan the QR code shown in the terminal.
- Make sure your phone and laptop are on the **same WiFi**.

---

## Push Notifications Setup

Push notifications work in two modes:

| Mode | How it works | When |
|---|---|---|
| **Expo Go** | Uses Expo Push Token via Expo's push service | When running via `npx expo start --go` |
| **Dev/Production APK** | Uses FCM (Firebase Cloud Messaging) with a device token | When running via EAS build |

For Expo Go, push notifications work **without Firebase** — Expo handles it through their own servers. You only need the Firebase service account on the backend (see `.env` setup) to handle both token types.

To test push notifications in Expo Go:
1. Log in on the app.
2. The app automatically registers and sends the push token to the backend (`/api/v1/users/push-token`).
3. Order status changes and stock alerts will trigger push notifications to the app.

---

## Further Development Notes

### Adding product images
- Images are uploaded via the Admin panel and stored in `backend/uploads/`.
- The backend serves them at `http://YOUR_IP:4000/uploads/filename.jpg`.
- The `uploads/` folder is **auto-created** when the first image is uploaded.
- Do not commit the `uploads/` folder to git.

### Adding carousel/banner images
- Replace the sample images in `frontend-expo/assets/images/`:
  - `carousel1-sample.png`, `carousel2-sample.png`, `carousel3-sample.png` — home screen banners
  - `logo-sample.png` — header logo
- Or update the paths in `Shared/Header.js` and `Shared/Banner.js`.

### Map (Delivery Address Picker)
- Uses **OpenStreetMap + Leaflet** via WebView — no Google Maps API key needed, completely free.
- Requires an internet connection to load the map tiles.
- If the map doesn't load in Expo Go, check your phone's internet and try restarting with `npx expo start --go -c`.

### Building a release APK (EAS)
> This is not required for Expo Go testing.
1. Install EAS CLI: `npm install -g eas-cli`
2. Log in: `eas login` (requires an Expo account)
3. Build: `cd frontend-expo && npx eas build --profile development --platform android`
4. The APK is uploaded to your Expo account and can be downloaded + installed on physical devices.

### Admin access
- Register normally, then manually set `isAdmin: true` on your user in MongoDB Atlas (find your user document and edit it).
- Admin users see an extra Admin drawer menu with product/category/order management.

---

## Quick Command Reference

```bash
# Backend
cd backend
npm install          # install packages
npm start            # start server (port 4000)

# Frontend
cd frontend-expo
npm install          # install packages
npx expo start --go -c   # start with Expo Go + clear cache
```

## Quick start

1. **Install:** `npm install`
2. **Set API URL:** Edit `assets/common/baseurl.js` and set `BACKEND_HOST` to your backend URL (see below).
3. **Run:** `npx expo start` then scan the QR code with Expo Go on your phone.

## Running on your phone (Expo Go)

See **[docs/SETUP-EXPO-GO.md](docs/SETUP-EXPO-GO.md)** for step-by-step setup (same WiFi, laptop IP, backend URL).

## Replacing images

- **Logo (header):** Replace `assets/images/logo-sample.png` or change the path in `Shared/Header.js`.
- **Carousel (home banner):** Replace `assets/images/carousel1-sample.png`, `carousel2-sample.png`, `carousel3-sample.png` or see `assets/images/README.md` for the full list.

## Backend

The app expects a backend at the URL in `assets/common/baseurl.js` (e.g. `http://YOUR_IP:4000/api/v1/`). Implement the API as in the project’s `docs/3-BACKEND-IMPLEMENTATION.md` (in the repo root).

---

## For group members: npm install messages

When you run **`npm install`** you may see:

- **Deprecation warnings** (e.g. `inflight`, `rimraf`, `glob`, `react-native-vector-icons`) — these come from dependencies, not our code. They are **safe to ignore** for this project; the app runs normally.
- **Vulnerabilities (e.g. “19 high severity”)** — many are in transitive dependencies used only at build time. To apply **safe** fixes without breaking Expo, run once after install:
  ```bash
  npm run audit:fix
  ```
  (or `npm audit fix`). **Do not run** `npm audit fix --force` — it can break the app by changing major versions. If some vulnerabilities remain after `npm audit fix`, that is expected and acceptable for this course project; the app is safe to develop and run.
